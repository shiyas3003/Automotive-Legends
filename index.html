<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Automotive Legacy Explorer</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-color: #0d1117;
      --primary-text: #e6edf3;
      --secondary-text: #7d8590;
      --accent-color: #22d3ee;
      --accent-glow: rgba(34, 211, 238, 0.3);
      --border-color: rgba(255, 255, 255, 0.1);
      --card-bg: rgba(22, 27, 34, 0.6);
    }
    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--bg-color);
      color: var(--primary-text);
      background-image: radial-gradient(circle at 1px 1px, rgba(255,255,255,0.05) 1px, transparent 0);
      background-size: 2rem 2rem;
    }
    .stat-card {
      background: rgba(0,0,0,0.2);
      border-radius: 12px;
      padding: 1rem;
      text-align: center;
      border: 1px solid var(--border-color);
    }
    .stat-card .stat-label {
      color: var(--secondary-text);
      font-size: 0.9rem;
      margin-bottom: 0.5rem;
    }
    .stat-card .stat-value {
      color: var(--accent-color);
      font-size: 1.75rem;
      font-weight: 700;
    }
  </style>
</head>
<body class="min-h-screen">

<header class="relative h-64 bg-cover bg-center text-white" style="background-image: url('https://source.unsplash.com/1600x900/?classic-car');">
  <div class="bg-black bg-opacity-60 h-full flex flex-col justify-center items-center">
    <h1 class="text-5xl font-bold drop-shadow-md">Automotive Legacy</h1>
    <p class="mt-2 text-lg text-slate-200">Explore the most influential cars in history</p>
  </div>
</header>

<main class="container mx-auto px-4 py-8" id="results-area">
  <div class="text-center text-slate-400">Loading vehicle data...</div>
</main>

<script>
const resultsArea = document.getElementById('results-area');
const year = 1993;
const category = 'Road Cars';
const continent = 'Asia';
const country = 'Japan';

function renderCarCard(car, year, rank = null) {
  const imageUrl = `https://source.unsplash.com/800x600/?${encodeURIComponent(year + ' ' + car.name)}`;
  const wikiLink = `https://en.wikipedia.org/wiki/${encodeURIComponent(car.name.replace(/ /g, '_'))}`;
  const countryFlag = car.country_code ? `<img src="https://flagcdn.com/w40/${car.country_code.toLowerCase()}.png" alt="${car.country}" class="inline w-5 h-5 ml-1">` : '';
  const badge = rank === 1 ? '<span class="ml-2 px-2 py-1 text-xs bg-green-500 text-black rounded-full">Top Seller</span>' : '';

  return `
    <div class="glassmorphism p-6 rounded-2xl fade-in-content mb-12">
      <h2 class="text-3xl md:text-4xl font-bold text-white mb-2">${car.name} <span class="text-gray-400 font-normal">(${year})</span>
        ${badge}
      </h2>
      <p class="text-gray-400 mb-6 max-w-3xl">${car.influence}</p>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
        <div class="stat-card">
          <div class="stat-label">Sales (${year})</div>
          <div class="stat-value">${car.sales_figures}</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Production Units</div>
          <div class="stat-value">${car.production_numbers}</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Original MSRP</div>
          <div class="stat-value">${car.original_msrp}</div>
        </div>
      </div>

      <div class="relative rounded-lg shadow-lg w-full h-64 md:h-96 bg-black/20 mb-8 border border-[var(--border-color)]">
        <img src="${imageUrl}" class="w-full h-full object-cover rounded-lg" alt="${car.name}">
      </div>

      <div class="flex gap-6 text-sm text-gray-300 mb-4 flex-wrap">
        <span>Country: ${countryFlag}</span>
        <span>Segment: ${car.segment || '—'}</span>
        <span>Engine: ${car.engine || '—'}</span>
        <span><a href="${wikiLink}" class="text-cyan-400 underline" target="_blank">Learn more</a></span>
      </div>
    </div>`;
}

async function fetchCarData() {
  const locationPrompt = country !== 'Any' ? `from ${country}` : (continent !== 'Any' ? `from ${continent}` : 'from anywhere in the world');
  const prompt = `Generate a list of the top 5 most influential ${category} vehicles ${locationPrompt} for the year ${year}. For each vehicle, provide its name, a short summary of its influence, a list of 3 interesting facts, a list of 4 key technical details, its approximate sales figures for that year, its total production numbers for that model year, and its original MSRP in USD. Present sales, production and MSRP as strings (e.g., \"Approx. 15,000 units\").`;

  const response = await fetch('https://gemini-backend-1eb3.onrender.com/generate', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ prompt })
  });

  if (!response.ok) {
    resultsArea.innerHTML = `<div class="text-red-400 text-center">Failed to fetch data: ${response.status}</div>`;
    return;
  }

  const result = await response.json();
  const text = result?.candidates?.[0]?.content?.parts?.[0]?.text;
  let data;
  try {
    data = JSON.parse(text);
  } catch (e) {
    resultsArea.innerHTML = `<div class="text-red-400 text-center">Error parsing data.</div>`;
    return;
  }

  if (!Array.isArray(data.cars)) {
    resultsArea.innerHTML = `<div class="text-red-400 text-center">No car data found.</div>`;
    return;
  }

  resultsArea.innerHTML = data.cars.map((car, i) => renderCarCard(car, year, i === 0 ? 1 : null)).join('');
}

fetchCarData();
</script>

</body>
</html>
