<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Automotive Legacy Explorer</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-color: #0d1117;
      --primary-text: #e6edf3;
      --secondary-text: #7d8590;
      --accent-color: #22d3ee;
      --accent-glow: rgba(34, 211, 238, 0.3);
      --border-color: rgba(255, 255, 255, 0.1);
      --card-bg: rgba(22, 27, 34, 0.6);
    }
    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--bg-color);
      color: var(--primary-text);
      background-image: radial-gradient(circle at 1px 1px, rgba(255,255,255,0.05) 1px, transparent 0);
      background-size: 2rem 2rem;
    }
    .stat-card {
      background: rgba(0,0,0,0.2);
      border-radius: 12px;
      padding: 1rem;
      text-align: center;
      border: 1px solid var(--border-color);
    }
    .stat-card .stat-label {
      color: var(--secondary-text);
      font-size: 0.9rem;
      margin-bottom: 0.5rem;
    }
    .stat-card .stat-value {
      color: var(--accent-color);
      font-size: 1.75rem;
      font-weight: 700;
    }
  </style>
</head>
<body class="min-h-screen">

<header class="relative h-64 bg-cover bg-center text-white" style="background-image: url('https://source.unsplash.com/1600x900/?classic-car');">
  <div class="bg-black bg-opacity-60 h-full flex flex-col justify-center items-center">
    <h1 class="text-5xl font-bold drop-shadow-md">Automotive Legacy</h1>
    <p class="mt-2 text-lg text-slate-200">Explore the most influential cars in history</p>
  </div>
</header>

<main class="container mx-auto px-4 py-8">
  <div class="glassmorphism p-6 rounded-2xl mb-10">
    <div class="flex flex-wrap gap-4 justify-center">
      <select id="year-select" class="bg-[#1f2937] text-white px-4 py-2 rounded-lg">
        <!-- Populated by JS -->
      </select>
      <select id="category-select" class="bg-[#1f2937] text-white px-4 py-2 rounded-lg">
        <option value="Road Cars">Road Cars</option>
        <option value="F1">F1</option>
        <option value="Rally">Rally</option>
      </select>
      <select id="continent-select" class="bg-[#1f2937] text-white px-4 py-2 rounded-lg">
        <option value="Any">Any</option>
        <option value="Europe">Europe</option>
        <option value="Asia">Asia</option>
        <option value="North America">North America</option>
      </select>
      <select id="country-select" class="bg-[#1f2937] text-white px-4 py-2 rounded-lg">
        <!-- Populated by JS -->
      </select>
      <button onclick="fetchCarData()" class="bg-cyan-500 text-black font-bold px-6 py-2 rounded-lg hover:scale-105 transition">Search</button>
    </div>
  </div>

  <div id="results-area">
    <div class="text-center text-slate-400">Loading vehicle data...</div>
  </div>
</main>

<script>
const resultsArea = document.getElementById('results-area');
const yearSelect = document.getElementById('year-select');
const categorySelect = document.getElementById('category-select');
const continentSelect = document.getElementById('continent-select');
const countrySelect = document.getElementById('country-select');

const countryData = {
  'Any': ['Any'],
  'Europe': ['Any', 'Germany', 'Italy', 'United Kingdom', 'France', 'Sweden'],
  'Asia': ['Any', 'Japan', 'South Korea'],
  'North America': ['Any', 'United States']
};

for (let year = new Date().getFullYear(); year >= 1950; year--) {
  const opt = document.createElement('option');
  opt.value = year;
  opt.textContent = year;
  yearSelect.appendChild(opt);
}

continentSelect.addEventListener('change', () => {
  const countries = countryData[continentSelect.value] || ['Any'];
  countrySelect.innerHTML = countries.map(c => `<option value="${c}">${c}</option>`).join('');
});
continentSelect.dispatchEvent(new Event('change'));

function renderCarCard(car, year, rank = null) {
  const imageUrl = `https://source.unsplash.com/800x600/?${encodeURIComponent(year + ' ' + car.name)}`;
  const wikiLink = `https://en.wikipedia.org/wiki/${encodeURIComponent(car.name.replace(/ /g, '_'))}`;
  const badge = rank === 1 ? '<span class="ml-2 px-2 py-1 text-xs bg-green-500 text-black rounded-full">Top Seller</span>' : '';

  return `
    <div class="glassmorphism p-6 rounded-2xl fade-in-content mb-12">
      <h2 class="text-3xl md:text-4xl font-bold text-white mb-2">${car.name} <span class="text-gray-400 font-normal">(${year})</span>
        ${badge}
      </h2>
      <p class="text-gray-400 mb-6 max-w-3xl">${car.influence}</p>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
        <div class="stat-card">
          <div class="stat-label">Sales (${year})</div>
          <div class="stat-value">${car.sales_figures}</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Production Units</div>
          <div class="stat-value">${car.production_numbers}</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Original MSRP</div>
          <div class="stat-value">${car.original_msrp}</div>
        </div>
      </div>
      <div class="relative rounded-lg shadow-lg w-full h-64 md:h-96 bg-black/20 mb-8 border border-[var(--border-color)]">
        <img src="${imageUrl}" class="w-full h-full object-cover rounded-lg" alt="${car.name}">
      </div>
      <div class="flex gap-6 text-sm text-gray-300 mb-4 flex-wrap">
        <span>Country: ${car.country || '—'}</span>
        <span>Segment: ${car.segment || '—'}</span>
        <span>Engine: ${car.engine || '—'}</span>
        <span><a href="${wikiLink}" class="text-cyan-400 underline" target="_blank">Learn more</a></span>
      </div>
    </div>`;
}

async function fetchCarData() {
  const year = yearSelect.value;
  const category = categorySelect.value;
  const continent = continentSelect.value;
  const country = countrySelect.value;

  const locationPrompt = country !== 'Any' ? `from ${country}` : (continent !== 'Any' ? `from ${continent}` : 'from anywhere in the world');
  const prompt = `Generate a list of the top 5 most influential ${category} vehicles ${locationPrompt} for the year ${year}. For each vehicle, provide its name, a short summary of its influence, a list of 3 interesting facts, a list of 4 key technical details, its approximate sales figures for that year, its total production numbers for that model year, and its original MSRP in USD. Present sales, production and MSRP as strings (e.g., \"Approx. 15,000 units\").`;

  resultsArea.innerHTML = '<div class="text-center text-slate-400">Fetching cars...</div>';

  try {
    const response = await fetch('https://gemini-backend-1eb3.onrender.com/generate', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ prompt })
    });

    const result = await response.json();
    const text = result?.candidates?.[0]?.content?.parts?.[0]?.text;
    const data = JSON.parse(text);

    if (!Array.isArray(data.cars)) throw new Error('Unexpected format');

    resultsArea.innerHTML = data.cars.map((car, i) => renderCarCard(car, year, i === 0 ? 1 : null)).join('');
  } catch (err) {
    resultsArea.innerHTML = `<div class="text-red-400 text-center">Error: ${err.message}</div>`;
  }
}

fetchCarData();
</script>
</body>
</html>
